TODO

pgld:

  - fix dbus support, especially for logging:
    The blocked IP logging messages should use separate objects for every item
    (SOURCE_IP, DESTINATION_IP, SOURCE_PORT, DESTINATION_PORT, PROTOCOL,
    TIMESTAMP) instead of a plain string, so that pgl-gui can easily use this
    information. Remove this logging from the general do_log.

  - use a real allowlist (instead of the iptables whitelisting):
    pgld [OPTIONS] [-A ALLOWLIST(s)] [-B BLOCKLISTS]
    - check packets first against the allowlist, if match: do the same as for
      non-matching against blocklist
    - then check against blocklist (same behaviour as currently)

  - add option to search for a specified IP in a blocklist:
    pgld -f IP BLOCKLIST
    if IP is found in the BLOCKLIST: return 0 and output the matching range(s).
    if IP is not found: return 1

  - make length of range description configurable (with LOWMEM:=range=0)





pglcmd:

  - nice: on CentOS it is required to use e.g. "+5". Find solutions suiting all
    distros.

  - adapt to real allow lists:
    requires allow lists in pgld, see above
    - add configuration file allowlists.lists to handle remote allowlists
      (like blocklists.list for remote blocklists)
    - load all allowlists in a specified folder "allowlists.local"
    - remove variables ALLOW_[IN|OUT|FWD]

  - search function:
    requires search function in pgld, see above.
    Use this function instead of grep'ping for REGEX.

  - improve use of traceroute in "pglcmd test":
    - test whether it is installed, use tcptraceroute etc. alternatively

  - use "ip addr" instead of "ifconfig":
    see http://jengelh.medozas.de/2008/0219-ifconfig-sucks.php

  - send error messages to console (STDERR 1>&2) and logfile.
    Completely rework the logging part, and check if all messages go where they
    should.

  - add dbus support, especially for logging. See below.

  - add pidfile for pglcmd (e.g. to prevent 2 starts at nearly the same time.
    How to handle "update"? - this does not conflict with start.

  - add possibility to shut off cron mails, even if CRON_MAILTO is empty.
    [http://forums.phoenixlabs.org/showthread.php?p=131335]

  - replace some "echo" lines with
      cat >> FILENAME <<END
      [text]
      END

  - Send traffic to several NFQUEUE nums with --queue-balance and run multiple
    pgld instances for these nums. This might help on heavy load.

    Alternatively increasing the default receive/send window seems to fix the
    problem:
        sysctl -w net.core.rmem_default=8388608
        sysctl -w net.core.wmem_default=8388608
    --
    peerguardian-devel@lists.sourceforge.net by dogg@retroject.net - 2010-04-20

  - on "stop" remove kernel modules that were inserted by blockcontrol. (see
    dino's synology packaging
    http://forums.phoenixlabs.org/showpost.php?p=128371&postcount=20). Probably
    disable this per default, to avoid problems.

  - fix debconf to use debian/config again.
    This stuff is currently in postinst, because otherwise debconf doesn't work
    as expected: Debconf runs twice during installation: first it asks questions
    and then it overwrites the answers with the not-yet modified configuration
    files.
    Further the debconf database is not cleared properly on purge.

  - adapt test function for peerguardian .p2b v2 binary format blocklist
    formats.

  - [DISCUSS]: if any blocklist is unavailable, should pglcmd exit (as it
    does currently, in order to give no false security), or continue but return
    an error (if one list is missing, it's still better to use at least the
    other blocklists).

  - [DISCUSS] Block IPv6 completely because currently only IPv4 is checked?



pgl-gui:

###############################################################################
  [freemind]
#13: enable "Undo All".

#9: add option "Reset to default"

#10: show blocklists like "example.com/list/list2" (I added this manually to
     blocklists.list, it downloads fine, but pgl-gui doesn't show it)

#17: whitelisting ports: allow port ranges "port:port"

#18: whitelisting ports: separating several items e.g. this way
     "125,126;127 128" does not work. Perhaps only use spaces (not comma or
     semi-colon), for consistency with pglcmd.

#19: add instant application of whitelisting rules:
     also execute the iptables command on "Apply" (additionally to the permanent
     addition of the values to the pglcmd variables, which requires a "pglcmd
     restart" for the application of the new iptables rules). For instant removal
     replace "-I" with "-D":
===============================================================================
Port whitelisting for given $PORT. Other variables taken from pglcmd configuration:
WHITE_TCP_IN:  iptables -I $IPTABLES_IN -p tcp --dport $PORT -j $IPTABLES_TARGET_WHITELISTING
WHITE_UDP_IN:  iptables -I $IPTABLES_IN -p udp --dport $PORT -j $IPTABLES_TARGET_WHITELISTING
WHITE_TCP_OUT: iptables -I $IPTABLES_OUT -p tcp --dport $PORT -j $IPTABLES_TARGET_WHITELISTING
WHITE_UDP_OUT: iptables -I $IPTABLES_OUT -p udp --dport $PORT -j $IPTABLES_TARGET_WHITELISTING
WHITE_TCP_FWD: iptables -I $IPTABLES_FWD -p tcp --dport $PORT -j $IPTABLES_TARGET_WHITELISTING
WHITE_UDP_FWD: iptables -I $IPTABLES_FWD -p udp --dport $PORT -j $IPTABLES_TARGET_WHITELISTING

IP whitelisting for given $IP. Other variables taken from pglcmd configuration::
WHITE_IP_IN:  iptables -I $IPTABLES_IN --source $IP -j $IPTABLES_TARGET_WHITELISTING
WHITE_IP_OUT: iptables -I $IPTABLES_OUT --destination $IP -j $IPTABLES_TARGET_WHITELISTING
WHITE_IP_FWD: iptables -I $IPTABLES_FWD --source $IP -j $IPTABLES_TARGET_WHITELISTING
              iptables -I $IPTABLES_FWD --destination $IP -j $IPTABLES_TARGET_WHITELISTING
===============================================================================

  - show pgld logfile. Allow right-click whitelisting of blocked IPs and/or
    ports/protocol. Requires pgld dbus logging.

  - pop-up warning on errors in pglcmd.conf. Requires pglcmd dbus logging.

  - policykit support (instead of kdesudo/gksu)

  - add option to temp allow, which inserts the appropriate iptables rules
    directly. (iptables --ctexpire (really?))

  - add whitelisting per IP/port/proto (pgl-gui-iptables-insert.sh)

  - clean up code: get rid of all unused remnants of mobloquer

###############################################################################

  [jre]
  - relicense everything to GPL3, fix headers especially of pgl-gui, update

  - Verify flags etc. in Makefile, use variables where possible
    verify where prerequisite FORMS_HEADERS is necessary

###############################################################################



All components:

  - use dbus for communication between components. Especially for logging
    events, instead of parsing the logfiles.

  - use inotify (available since Linux kernel 2.6.13) to reload after
    configuration change.



Packaging:

  - add LOWMEM flavor packages

  - add debtags to debian packages



Web:

  - Update phoenixlabs.org

  - update wiki.phoenixlabs.org
